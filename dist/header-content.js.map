{"version":3,"file":"header-content.js","sourceRoot":"","sources":["../src/header-content.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter, TemplateRef, ViewChild, Renderer2, ElementRef } from '@angular/core';\nimport { Platform, Content, Toolbar } from 'ionic-angular';\nimport { Subscription } from 'rxjs/Subscription';\n\nconst HTML_TEMPLATE = `\n<ion-header class=\"statusbar\" #nav>\n  <ion-navbar>\n    <ng-container *ngTemplateOutlet=\"navbarStart\"></ng-container>\n    <ion-title><span #fade>{{title}}</span></ion-title>\n    <ng-container *ngTemplateOutlet=\"navbarEnd\"></ng-container>\n  </ion-navbar>\n  <ng-container *ngTemplateOutlet=\"headerEnd\"></ng-container>\n</ion-header>\n\n<ion-content fullscreen no-bounce>\n  <div #toolbar>\n    <h1 #header class=\"bold-header\">{{title}}</h1>\n    <ion-toolbar [hidden]=\"!search\" #searchbar>\n        <ion-searchbar\n        [(ngModel)]=\"query\"\n        (ionInput)=\"queryChange.emit(query)\">\n      </ion-searchbar>\n    </ion-toolbar>\n  </div>\n  <ng-content></ng-content>\n</ion-content>\n`;\n\n@Component({\n  selector: 'header-content',\n  template: HTML_TEMPLATE,\n  styles: [ '.bold-header { padding-top: 0px;margin: 0;padding-left: 15px;padding-bottom: 0px;font-size: 2.7em;font-weight: bolder;color: #111}',\n            '.statusbar{padding-top: calc(20px);padding-top: calc(constant(safe-area-inset-top) + 4px);padding-top: calc(env(safe-area-inset-top));min-height: calc(44px + 20px);min-height: calc(44px + constant(safe-area-inset-top));min-height: calc(44px + env(safe-area-inset-top)); }']\n})\nexport class HeaderContentComponent {\n\n  //Settings\n  @Input() title: string;\n  @Input() search: boolean = false;\n  @Input() forceIOS: boolean = false;\n  @Input() contentbox: any;\n\n  //Searchbar\n  @Input() query: string;\n  @Output() queryChange: EventEmitter<string> = new EventEmitter<string>();\n\n  //Templates\n  @Input() navbarStart: TemplateRef<void>;\n  @Input() navbarEnd: TemplateRef<void>;\n  @Input() headerEnd: TemplateRef<void>;\n\n  //Elements\n  @ViewChild('searchbar') searchbar: Toolbar;\n  @ViewChild('toolbar') toolbar: ElementRef;\n  @ViewChild('nav') nav: ElementRef;\n  @ViewChild('fade') fade: ElementRef;\n  @ViewChild('header') element: ElementRef;\n  @ViewChild(Content) content: Content;\n\n  //Events\n  private subscriptionScroll: Subscription;\n  private changes: MutationObserver;\n  @Output() public domChange = new EventEmitter();\n  @Output() appear: EventEmitter<boolean>;\n\n  //Utils\n  private ios: boolean = false;\n  private state: boolean = false;\n\n\n\n  constructor(private renderer: Renderer2, private platform: Platform) {\n\n  }\n\n  //Life cycle\n  ngAfterViewInit(){\n    this.platform.ready().then(() => {\n      this.ios = this.platform.is('ios') || this.forceIOS;\n      if (this.ios) this.initIOS();\n      else this.initAndroid();\n    });\n  }\n\n  ngOnDestroy(){\n    this.unsubscribe();\n  }\n\n  //Sub Management\n  unsubscribe(){\n    if(this.subscriptionScroll) this.subscriptionScroll.unsubscribe();\n    if (this.changes) this.changes.disconnect();\n  }\n\n  subscribe(){\n    this.contentChange();\n    this.subscriptionScroll =  this.content.ionScroll\n      .subscribe((data) => {\n        if (!this.state && data.scrollTop >= this.element.nativeElement.offsetHeight-5){\n          this.state = true;\n          this.transitionToHeader()\n        }\n        if (this.state && data.scrollTop < this.element.nativeElement.offsetHeight){\n          this.state = false;\n          this.transitionToBody()\n        }\n      });\n  }\n\n\n  //Subscription logic\n  contentChange(){\n    if (this.contentbox){\n      this.changes = new MutationObserver((mutations: MutationRecord[]) => {\n        if (this.contentbox.clientHeight < this.content.contentHeight) this.transitionToBody();\n      });\n      this.changes.observe(this.contentbox, {\n        attributes: true,\n        childList: true,\n        characterData: true\n      });\n    }\n  }\n\n  initIOS(){\n    this.contentChange();\n    this.renderer.setStyle(this.element.nativeElement, 'transition', 'opacity 1s linear');\n    this.renderer.setStyle(this.element.nativeElement, 'opacity', '1');\n    this.appear = new EventEmitter<boolean>();\n    let height = this.toolbar.nativeElement.clientHeight; //USE RULER\n    let styleheight = height + 'px';\n    this.renderer.setStyle(this.toolbar.nativeElement, 'min-height', styleheight)\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '0');\n    this.renderer.setStyle(this.fade.nativeElement, 'transition', 'opacity 0.155s linear');\n    this.subscribe();\n  }\n\n  initAndroid(){\n    this.renderer.setStyle(this.element.nativeElement, 'display', 'none');\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '1');\n    if (this.searchbar) this.renderer.appendChild(this.nav.nativeElement, this.searchbar._elementRef.nativeElement)\n  }\n\n  transitionToHeader(){\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '1');\n    if (this.searchbar) this.renderer.appendChild(this.nav.nativeElement, this.searchbar._elementRef.nativeElement)\n  }\n\n  transitionToBody(){\n    if (this.searchbar) this.renderer.appendChild(this.toolbar.nativeElement, this.searchbar._elementRef.nativeElement)\n    this.renderer.setStyle(this.fade.nativeElement, 'opacity', '0');\n  }\n\n  //Extra\n\n  debug(){\n    console.log('content', JSON.stringify(this.contentbox))\n    console.log('element:', this.element);\n    console.log('toolbar:', this.toolbar);\n    console.log('fade:', this.fade);\n    console.log('searchbar', this.searchbar);\n    console.log('nav', this.nav);\n  }\n\n}\n"]}